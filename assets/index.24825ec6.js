import{t as e,c as t,u as n,a as r,o,i,b as a,s,d as l,e as c,f as d,g as u,k as g,h as f,E as p,j as h,F as m,l as w,m as v,n as y,q as b,p as x,r as _,v as k,w as N,x as A,y as S,z as E,A as j,B as P,C as T,D as $,G as C,H as D,I as L,J as M,K as I,L as z,M as R,N as F,O,P as U}from"./vendor.95db164c.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();function B(e){throw console.log("not never:",e),new Error("Expected never")}function V(e,t){var n,r;const o=null!=(r=null!=(n=t[e.kind])?n:t.unsupported)?r:()=>{throw new Error("condition "+e.kind+" was not handled and no unsupported branch")};return()=>o(e)}const q=e("<time></time>");function H(e){return t((()=>V(e.item,e.children)()))}function W(e){const n=t((()=>e.when),void 0,{equals:(e,t)=>!e==!t});return t((()=>n()?e.children:e.fallback))}function K(e){return t((()=>{var t,r;if((null==(r=null==(t=e.if)?void 0:t[0])||r)&&null!=e.when){const t=e.children;return n((()=>t(e.when)))}return e.fallback}))}function Y(e,t){const n=document.getSelection();if(!1===(null==n?void 0:n.isCollapsed))return!1;let r=e;for(;r&&r!==t;){if(r instanceof HTMLElement&&("A"===r.nodeName||"BUTTON"===r.nodeName||"VIDEO"===r.nodeName||"AUDIO"===r.nodeName||"INPUT"===r.nodeName||"TEXTAREA"===r.nodeName||"IFRAME"===r.nodeName||r.classList.contains("resizable-iframe")||r.classList.contains("handles-clicks")))return!1;r=r.parentNode}return!0}function G(e,t){if(!t.endsWith("s"))throw new Error("!s");return 1===e?e+t.substring(0,t.length-1):e+t}function J(e){const[n,l]=r(Date.now()),c=t((()=>{const t=function(e,t){const n=t-e;if(n<0)return["in the future "+new Date(e).toISOString(),-n];if(n<6e4)return["just now",6e4-n];let r=6e4,o=60;if(n<o*r){const e=n/r|0;return[G(e," minutes")+" ago",r-(n-e*r)]}if(r*=o,o=24,n<o*r){const e=n/r|0;return[G(e," hours")+" ago",r-(n-e*r)]}if(r*=o,o=30,n<o*r){const e=n/r|0;return[G(e," days")+" ago",r-(n-e*r)]}return[new Date(e).toISOString(),-1]}(e.start,n());if(t[1]>0){const e=setTimeout((()=>l(Date.now())),Math.min(t[1]+10,2147483647));o((()=>clearTimeout(e)))}return t[0]}));return(()=>{const t=q.cloneNode(!0);return i(t,c),a((n=>{const r=new Date(e.start).toString(),o=""+new Date(e.start);return r!==n._v$&&s(t,"datetime",n._v$=r),o!==n._v$2&&s(t,"title",n._v$2=o),n}),{_v$:void 0,_v$2:void 0}),t})()}let X=function(e,t){for(const n of Object.keys(t.frames).reverse()){const t=+n;if(e>=t)return t}throw new Error("requested frame "+e+" not found. note: the zero frame is required to exist.")},Q=function(e,t,n,r,o){var i,a,s;let c=t,d=[];const u=new Set,g=new Set;for(const{touch:l,actionSet:v}of[{touch:!0,actionSet:()=>e},{touch:!1,actionSet:()=>r},{touch:!1,actionSet:()=>d}])for(const e of[...v()].reverse())if(!g.has(e.id)){if(l)u.add(e.frame);else if(!u.has(e.frame))continue;"invalidate_action"===e.kind&&(g.add(e.invalidate.id),e.invalidate.time<=c.last_action_time&&(c={last_action_time:0,frames:{0:{merged_polygons:[],thumbnail:[]}}},d=n))}const f={};for(const l of u)f[l]||(f[l]={...null!=(i=c.frames[l])?i:{merged_polygons:[],thumbnail:[]}});let p=0;for(const v of[...d,...e,...r])if(!g.has(v.id)&&u.has(v.frame)){p+=1;try{const e=f[v.frame];"add_polygon"===v.kind?e.merged_polygons=l.union(e.merged_polygons,[v.polygon]):"erase_polygon"===v.kind?e.merged_polygons=l.difference(e.merged_polygons,[v.polygon]):"invalidate_action"===v.kind||B(v)}catch(w){alert("Error while processing frame "+v.frame+". This frame may be corrupted."),console.log(w)}}for(const l of u){const e=f[l];e.thumbnail=Z(e.merged_polygons,o)}const h=[...d,...e,...r],m=null!=(s=null==(a=h[h.length-1])?void 0:a.insert_time)?s:0;return console.log("regenerated frames:",u,"in",p,"ignoring",g),{...c,frames:{...c.frames,...t.frames,...f},last_action_time:m}};function Z(e,t){return c({type:"Feature",geometry:{type:"MultiPolygon",coordinates:e}},Math.min(t.width,t.height)/40).geometry.coordinates}const ee=e('<div class="h-full"></div>'),te=e('<canvas class="w-full h-full fixed top-0 left-0 bottom-0 right-0"></canvas>'),[ne,re]=r(!1);function oe(e){const t=t=>{"f"===t.key&&(ne()?(re(!1),ge()):(re(!0),fe(0,e.state)))};return document.addEventListener("keypress",t),o((()=>document.removeEventListener("keypress",t))),(()=>{const t=ee.cloneNode(!0);return i(t,d(se,{get state(){return e.state},get applyAction(){return e.applyAction}}),null),i(t,d(W,{get when(){return!ne()},get children(){return d(pe,{get state(){return e.state},get applyAction(){return e.applyAction}})}}),null),t})()}function ie(e){const t={width:window.innerWidth,height:window.innerHeight},n=ne(),r=n?0:50,o=t.width,i=t.height-(n?0:200),a=e.width,s=e.height,l=Math.min((o-2*r)/a,(i-2*r)/s);return{scale:l,translate:{x:o/l/2-a/2,y:i/l/2-s/2}}}function ae(e,t){const{scale:n,translate:r}=ie(t);e.scale(n,n),e.translate(r.x,r.y)}function se(e){return d(we,{render:(t,n)=>{const r=Date.now(),o=ce();t.fillStyle="#ccc",t.fillRect(0,0,n.width,n.height),t.save(),ae(t,e.state.config),t.save(),t.fillStyle="#fff",t.fillRect(0,0,e.state.config.width,e.state.config.height),t.restore(),t.strokeRect(0,0,e.state.config.width,e.state.config.height),t.save(),t.strokeStyle="rgba(0, 0, 0, 0.5)",null==o&&(t.beginPath(),t.moveTo(e.state.config.width/2,0),t.lineTo(e.state.config.width/2,e.state.config.height),t.moveTo(0,e.state.config.height/2),t.lineTo(e.state.config.width,e.state.config.height/2),t.stroke()),t.restore();let i=e.state.frame;null!=o&&(i=o);const a=X(i,e.state.cached_state),s=e.state.cached_state.frames[a];if(null==o&&a-1>=0){const n=X(a-1,e.state.cached_state),r=e.state.cached_state.frames[n];t.fillStyle="rgba(0, 255, 0, 0.5)",he(t,r.merged_polygons)}if(null==o){const n=i+1;if(X(n,e.state.cached_state)!==a){const r=e.state.cached_state.frames[n];t.fillStyle="rgba(255, 0, 0, 0.5)",he(t,r.merged_polygons)}}const l=a===i||null!=o;t.fillStyle=l?"#000000":"#aaa",he(t,s.merged_polygons),t.restore();const c=Date.now();t.fillStyle="#000000",ne()||(t.fillText("Last Update ms: "+e.state.update_time,10,20),t.fillText("Draw ms: "+(c-r),10,30),t.fillText("Vertices: "+s.merged_polygons.reduce(((e,t)=>e+t.reduce(((e,t)=>e+t.length),0)),0),10,40),t.fillText("Frame: "+i+" / "+e.state.max_frame,10,50),t.fillText("Actions: "+e.state.actions.length,10,60),t.fillText("Project: "+e.state.config.title,10,70))}})}let le=null;const[ce,de]=r(null);function ue(e,t){e.source.addEventListener("ended",(()=>{}));const n=()=>le?(de((le.offset+le.context.currentTime)*t|0),!0):(de(null),!1);n(),function(e){const t=()=>requestAnimationFrame((()=>{e()&&t()}));t()}(n)}function ge(){le&&(le.source.stop(),le=null)}function fe(e,t){let n=e/t.config.framerate;n<0&&(n=0),n>t.audio.duration&&(n=t.audio.duration);const r=t.audio_ctx.createBufferSource();r.buffer=t.audio,r.connect(t.audio_ctx.destination),r.playbackRate.setValueAtTime(1,0),r.start(0,n,t.audio.duration-n),function(e,t){ge(),le={...e,offset:e.offset-e.context.currentTime},ue(e,t)}({source:r,offset:n,context:t.audio_ctx},t.config.framerate)}function pe(e){const[n,i]=r(new Map),a=e=>g(e.points,{simulatePressure:e.points.every((e=>.5===e[2])),size:"erase"===e.mode?100:8}),s=t=>{const{scale:n,translate:r}=ie(e.state.config);return[t[0]/n-r.x,t[1]/n-r.y,t[2]]},[l,c]=r(null),[u,f]=r(0),[p,h]=r(250),[m,w]=r(1),v=()=>p()*m(),y=t((()=>[...n().values()].map(a)));return o(function(e){const t=[],n=new Map,r=e=>{const t=n.get(e);if(!t||0===t.points.size){const t={points:new Map};return n.set(e,t),t}return t},o=e=>[...e.points.values()].map((e=>e[0].time)).reduce(((e,t)=>Math.min(e,t)),1/0),i=e=>[e.pageX,e.pageY,e.pressure],a=e=>{let t=e[0].point[0],n=e[0].point[0],r=e[0].point[1],o=e[0].point[1];for(const{point:i}of e)i[0]<t&&(t=i[0]),i[0]>n&&(n=i[0]),i[1]<r&&(r=i[1]),i[1]>o&&(o=i[1]);return n-t+(o-r)},s=(e,t)=>{if(0===e.points.size)return{kind:"none"};const n=o(e),r=[...e.points.values()],i=r.reduce(((e,t)=>Math.max(e,t[0].time)),0);if(t.commit&&n>Date.now()-200&&r.length>1&&!r.map(a).some((e=>e>10)))return{kind:"tap",points:r.map((e=>e[0].point))};if(1===r.length)return{kind:"draw",points:r[0].map((e=>e.point)),...t};const s=r.map((e=>{const t=e.findIndex((e=>e.time>=i));return-1===t?e[e.length-1]:e[t]}));return 2===r.length?{kind:"touchzoom",start:s.map((e=>e.point)),end:r.map((e=>e[e.length-1].point)),...t}:{kind:"none"}};document.documentElement.classList.add("no-interact"),t.push((()=>document.documentElement.classList.remove("no-interact")));const l=t=>{t.preventDefault();const n=r(t.pointerType),a=o(n);Date.now()>a+200||(n.points.set(t.pointerId,[{time:Date.now(),point:i(t)}]),e(t.pointerType,s(n,{commit:!1})))};document.addEventListener("pointerdown",l),t.push((()=>document.removeEventListener("pointerdown",l)));const c=t=>{const n=r(t.pointerType),o=n.points.get(t.pointerId);o&&(t.preventDefault(),o.push({time:Date.now(),point:i(t)}),e(t.pointerType,s(n,{commit:!1})))};document.addEventListener("pointermove",c),t.push((()=>document.removeEventListener("pointermove",c)));const d=t=>{t.preventDefault();const o=r(t.pointerType);if(!o.points.has(t.pointerId))return;const i=s(o,{commit:!0});n.delete(t.pointerType),e(t.pointerType,i)};document.addEventListener("pointerup",d),t.push((()=>document.removeEventListener("pointerup",d)));const u=t=>{const n=r(t.pointerType);n.points.has(t.pointerId)&&(n.points.delete(t.pointerId),e(t.pointerType,s(n,{commit:!1})))};document.addEventListener("pointercancel",u),t.push((()=>document.removeEventListener("pointercancel",u)));const g=e=>{e.preventDefault()};return document.addEventListener("contextmenu",g),t.push((()=>document.removeEventListener("contextmenu",g))),()=>t.forEach((e=>e()))}(((t,r)=>{let o=!1;let d=!1;let u=!1;V(r,{draw:n=>{const r=n.points[0];if(r[1]>window.innerHeight-200){const t=n.points[n.points.length-1][0]-r[0],o=-Math.round(t/v());return void(n.commit?e.applyAction({kind:"set_frame",frame:e.state.frame+o}):(o!==l()&&fe(e.state.frame+o,e.state),c(o),u=t+o*v(),d=!0,f(u)))}var u;const g={points:n.points.map(s),mode:"draw"};var p;n.commit?e.applyAction({kind:"add_polygon",polygon:a(g),frame:e.state.frame}):(p=g,o=!0,i((e=>{const n=new Map(e);return n.set(t,p),n})))},touchzoom:e=>{const t=e=>Math.hypot(e[1][0]-e[0][0],e[1][1]-e[0][1]),n=window.innerHeight-200;if(e.start[0][1]>n&&e.start[1][1]>n){const n=t(e.start),r=t(e.end)/n;e.commit?h((e=>e*r)):(u=!0,w(r))}},tap:t=>{2===t.points.length?e.applyAction({kind:"undo"}):3===t.points.length&&e.applyAction({kind:"redo"})},none:()=>{}})();e:if(!o){const e=n();if(!e.has(t))break e;const r=new Map(e);r.delete(t),i(r)}d||(f(0),c(null),ge()),u||w(1)}))),d(we,{render:(t,n)=>{var r,o;t.save(),ae(t,e.state.config);const i=Date.now();t.fillStyle="#000";for(const e of y()){t.beginPath();let n=!0;for(const[r,o]of e)n?(t.moveTo(r,o),n=!1):t.lineTo(r,o);t.fill()}t.restore(),t.fillStyle="#aaa",t.fillRect(0,n.height-200,n.width,200);const a=e.state.frame+(null!=(r=l())?r:0);{t.save(),t.translate(n.width/2-90,0),t.scale(v()/2500,1),t.fillStyle="#999";const r=100;t.fillRect(-r,n.height-200,e.state.config.width+2*r,200),t.restore()}for(let l=-3;l<=3;l++){const r=l+a;if(r<0)continue;const o=X(r,e.state.cached_state),i=o===r,s=e.state.cached_state.frames[o].thumbnail;t.save(),t.translate(n.width/2-90+v()*l,n.height-200+45),t.scale(v()/2500,v()/2500),t.translate(u()/.1,0),i?t.fillStyle="#fff":(t.fillStyle="rgba(255, 255, 255, 0.4)",t.fillRect(-580,0,580,e.state.config.height),t.fillStyle="#ddd"),t.fillRect(0,0,e.state.config.width,e.state.config.height),t.fillStyle=i?"#000":"#888",he(t,s),t.restore()}t.fillStyle="#000";const s=e.state.audio_data,c=e.state.frame/e.state.config.framerate*e.state.audio.sampleRate|0;for(let e=0;e<15;e++)t.fillText(""+Math.abs(null!=(o=s[c+e])?o:0),10,n.height-200+10*(e+5));const d=Date.now();t.fillText("Draw ms: "+(d-i),10,n.height-200+20),t.fillText("Frame: "+a+" / "+e.state.max_frame,10,n.height-200+30)}})}function he(e,t){for(const n of t)me(e,n)}function me(e,t){e.beginPath();for(const n of t){let t=!0;for(const[r,o]of n)t?(e.moveTo(r,o),t=!1):e.lineTo(r,o)}e.fill()}function we(e){const t=()=>({width:window.innerWidth,height:window.innerHeight}),[n,i]=r(t()),a=()=>{i(t())};return window.addEventListener("resize",a),o((()=>window.removeEventListener("resize",a))),(()=>{const t=te.cloneNode(!0);return(t=>{const r=t.getContext("2d");u((()=>{const o=n(),i=window.devicePixelRatio;t.width!==o.width*i&&(t.width=o.width*i),t.height!==o.height*i&&(t.height=o.height*i),r.setTransform((new DOMMatrixReadOnly).scale(i)),null==r||r.clearRect(0,0,o.width,o.height),e.render(r,o)}))})(t),t})()}const ve=e('<div class="min-h-full p-4 bg-red-900 text-white"><button class="border px-2">Code</button> / <button class="border px-2">Retry</button><pre class="whitespace-pre-wrap"><code> </code></pre></div>');function ye(e){const[t,n]=r(!0);return d(p,{fallback:(t,r)=>(console.log(t),(()=>{const o=ve.cloneNode(!0),i=o.firstChild,s=i.nextSibling.nextSibling,l=s.nextSibling.firstChild.firstChild;return i.$$click=()=>console.log(t,e.data),s.$$click=()=>{n(!1),setTimeout((()=>n(!0)),200),r()},a((()=>l.data=t instanceof Error?t.toString()+"\n\n"+t.stack:"Something went wrong")),o})()),get children(){return d(W,{get when(){return t()},get fallback(){return"Retrying..."},get children(){return e.children}})}})}f(["click"]);const be=e('<label><div class="text-sm text-gray-800">:</div></label>'),xe=e("<input>"),_e=e("<div></div>"),ke=e('<div role="heading" class="text-3xl font-black"></div>'),Ne=e("<hr>"),Ae=e('<div class="pb-4"></div>'),Se=e('<div class="pb-2"></div>'),Ee=e('<div class="flex flex-row flex-wrap gap-4 <sm:flex-col"></div>'),je=e('<p class="text-sm text-gray-700"><span class="text-red-600">Error! </span></p>'),Pe=e('<input type="file">'),Te=e('<ul class="text-red-600"></ul>'),$e=e("<li></li>"),Ce=e("<button></button>"),De=e('<button class="text-blue-600 bg-blue-100 hover:bg-blue-200 transition px-1">&lt; Back</button>'),Le=e('<div class="flex flex-col gap-2"></div>'),Me=e('<p class="text-sm text-gray-700">You don\'t have any projects.</p>'),Ie=e('<p class="text-sm text-red-600">Error: </p>'),ze=e('<div tabindex="0"><div></div><div class="text-sm font-light">Updated </div></div>'),Re=e('<div class="flex flex-row justify-center"></div>'),Fe=e('<div class="pb-1"></div>'),Oe=e('<p class="text-sm text-gray-700">Note: In demo mode, you cannot save your animations.</p>'),Ue=e("<div>You are signed in as </div>"),Be=e('<div class="w-full max-w-md py-50"><div class="p-4 shadow-md bg-white border"></div></div>'),Ve=e('<p class="text-red-600"></p>'),qe=e('<p class="text-base text-red-600">Your work will not be saved.</p>'),He=e('<ul class="flex flex-col gap-2"></ul>'),We=e('<li tabindex="0"> - <!> / </li>'),Ke=e("<div> <!>…</div>"),Ye=e('<p class="text-sm text-red-600">Error while <!>: </p>'),Ge=e('<a class="underline underline-dotted hover:underline-solid" target="_blank" rel="noopener noreferrer"></a>'),Je=e('<button class="w-full h-full flex flex-col flex-wrap items-center justify-center bg-gray-100"><span></span></button>'),Xe=e('<svg class="animate-spin mr-1 h-5 w-5 text-black inline-block align-middle" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><title>Loading…</title><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor"></path></svg>'),Qe=(()=>{const e=new Uint8Array(16);return crypto.getRandomValues(e),[...e].map((e=>e.toString(16).padStart(2,"0"))).join("")})();function Ze(e){return(()=>{const t=be.cloneNode(!0),n=t.firstChild,r=n.firstChild;return i(n,(()=>e.text),r),i(t,(()=>e.children),null),t})()}function et(e){return(()=>{const t=_e.cloneNode(!0);return i(t,d(Ze,{get text(){return e.label},get children(){const t=xe.cloneNode(!0);return t.$$keydown=t=>{"Enter"===t.code&&(e.disabled||(t.preventDefault(),e.onenter()))},t.$$input=t=>{e.setValue(t.currentTarget.value)},a((n=>{const r=e.type,o="border px-3 py-2 block w-full "+(e.disabled?"text-gray-700 bg-gray-100 cursor-not-allowed":""),i=e.disabled,a=e.placeholder,l=e.value;return r!==n._v$&&s(t,"type",n._v$=r),o!==n._v$2&&(t.className=n._v$2=o),i!==n._v$3&&(t.disabled=n._v$3=i),a!==n._v$4&&s(t,"placeholder",n._v$4=a),l!==n._v$5&&(t.value=n._v$5=l),n}),{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0}),t}})),t})()}function tt(e){return[(()=>{const t=ke.cloneNode(!0);return i(t,(()=>e.children)),t})(),Ne.cloneNode(!0)]}function nt(e){const[t,n]=r(""),[o,a]=r(""),[s,l]=r(!1),[c,u]=r(void 0),g=()=>e.loading||!1!==s(),f=y(),p=w();async function h(e){const t={created:j(),projects:{}},n=_(p,"/users/"+e);null==(await C(n)).val()&&await P(n,t)}function m(t){t.then((()=>{e.popPage()})).catch((e=>{l(!1),console.log(e),u(""+e.toString())}))}return[d(at,{get popPage(){return e.popPage}}),d(tt,{children:"Email Account"}),Ae.cloneNode(!0),d(et,{type:"email",label:"Email",placeholder:"name@example.com",get disabled(){return g()},get value(){return t()},setValue:n,onenter:()=>{}}),Se.cloneNode(!0),d(et,{type:"password",label:"Password",get disabled(){return g()},get value(){return o()},setValue:a,onenter:()=>{}}),Ae.cloneNode(!0),(()=>{const e=Ee.cloneNode(!0);return i(e,d(it,{style:"gray",class:"flex-1",get disabled(){return g()},onClick:()=>{l("create_account"),m((async()=>{const e=await k(f,t(),o());await h(e.user.uid)})())},get children(){return d(W,{get when(){return"create_account"===s()},get fallback(){return"Create Account"},get children(){return d(vt,{})}})}}),null),i(e,d(it,{style:"green",class:"sm:min-w-max sm:w-30",get disabled(){return g()},onClick:()=>{l("log_in"),m((async()=>{const e=await N(f,t(),o());await h(e.user.uid)})())},get children(){return d(W,{get when(){return"log_in"===s()},get fallback(){return"Log In"},get children(){return d(vt,{})}})}}),null),e})(),d(K,{get when(){return c()},children:e=>[Se.cloneNode(!0),(()=>{const t=je.cloneNode(!0),n=t.firstChild;return n.firstChild,i(n,e,null),t})()]})]}function rt(){const e=w();return A(_(e,"/_")).key}function ot(e){const[t,n]=r(!1),[o,s]=r(""),[l,c]=r(null),[u,g]=r(""),[f,p]=r(""),h=w(),b=y(),x=v(),k=A(_(h,"/projects")),N=k.key,T=_(h,"/users/"+b.currentUser.uid+"/projects/"+N),$=S(x,"/user/"+b.currentUser.uid+"/"+rt()),C=()=>+u(),D=()=>{const e=f().split("x");return 2!==e.length?[0,0]:[+e[0],+e[1]]},L=()=>{const e=[];return o().trim()||e.push("Name required"),l()?1!==l().length?e.push("Max one audio file"):l().item(0).name.endsWith(".mp3")||e.push("Audio file must be .mp3"):e.push("Audio required"),C()||e.push("FPS required"),D().some((e=>!e))&&e.push("Size required"),e};return[d(at,{get popPage(){return e.popPage}}),d(tt,{children:"Create Project"}),Ae.cloneNode(!0),d(et,{type:"text",label:"Project Name",get disabled(){return!1!==t()},get value(){return o()},setValue:s,onenter:()=>{}}),Se.cloneNode(!0),d(Ze,{text:"Audio",get children(){const e=Pe.cloneNode(!0);return e.$$input=e=>{c(e.currentTarget.files)},a((()=>e.disabled=!1!==t())),e}}),Se.cloneNode(!0),d(et,{type:"text",label:"Frames per Second",placeholder:"15",get disabled(){return!1!==t()},get value(){return u()},setValue:g,onenter:()=>{}}),Se.cloneNode(!0),d(et,{type:"text",label:"Size",placeholder:"1920x1080",get disabled(){return!1!==t()},get value(){return f()},setValue:p,onenter:()=>{}}),Ae.cloneNode(!0),d(it,{class:"w-full",style:"green",get disabled(){return 0!==L().length||"create_project"===t()},onClick:()=>{if(0!==L().length)return alert("unresolved errors");n("create_project");const t=l().item(0);(async()=>{const e=S($,"/"+t.name),n=await E(e,await t.arrayBuffer());console.log(n.metadata.fullPath);const r={created:j(),owner:b.currentUser.uid,config:{title:o(),audio:n.metadata.fullPath,framerate:C(),width:D()[0],height:D()[1]}},i={updated:j()};console.log("creating project",r),await P(k,r),await P(T,i)})().then((t=>{n(!1),e.replacePage({kind:"animator_loader",project_id:N})})).catch((e=>{n(!1),console.log(e),alert("error creating project: "+e.toString())}))},get children(){return d(W,{get when(){return"create_project"!==t()},get fallback(){return d(vt,{})},children:"Create Project"})}}),(()=>{const e=Te.cloneNode(!0);return i(e,d(m,{get each(){return L()},children:e=>(()=>{const t=$e.cloneNode(!0);return i(t,e),t})()})),e})()]}function it(e){return(()=>{const t=Ce.cloneNode(!0);return t.$$click=()=>e.onClick(),i(t,(()=>e.children)),a((()=>t.className="border px-4 py-2 block "+e.class+" "+{gray:()=>{var t;return"transition "+(null!=(t=e.disabled)&&t?"text-gray-700 bg-gray-100 cursor-not-allowed":"bg-gray-200 hover:shadow-md hover:bg-white")},green:()=>{var t;return null!=(t=e.disabled)&&t?"text-gray-700 bg-gray-100 cursor-not-allowed":"border-green-400 bg-gradient-to-r from-green-400 to-green-500 text-white font-bold hover:shadow-md"}}[e.style]())),t})()}function at(e){return(()=>{const t=De.cloneNode(!0);return t.$$click=()=>{e.popPage()},t})()}function st(e){const t=w(),n=y(),r=_(t,"/users/"+n.currentUser.uid),[o]=bt(r);return[d(it,{class:"w-full",style:"gray",onClick:()=>{e.pushPage({kind:"create_project"})},children:"+ Create Project"}),Ae.cloneNode(!0),d(H,{item:o,children:{loading:()=>d(vt,{}),error:e=>(()=>{const t=je.cloneNode(!0),n=t.firstChild;return n.firstChild,i(n,(()=>e.message),null),t})(),loaded:t=>(()=>{const n=Le.cloneNode(!0);return i(n,d(m,{get each(){var e;return Object.entries(null!=(e=t.value.projects)?e:{})},get fallback(){return Me.cloneNode(!0)},children:t=>d(lt,{get pushPage(){return e.pushPage},project:t})})),n})()}})]}function lt(e){const t=w(),n=_(t,"/projects/"+e.project[0]),[r]=bt(n),o=()=>{e.pushPage({kind:"animator_loader",project_id:e.project[0]})};return d(H,{item:r,children:{loading:()=>d(vt,{}),error:e=>(()=>{const t=Ie.cloneNode(!0);return t.firstChild,i(t,(()=>e.message),null),t})(),loaded:t=>(()=>{const n=ze.cloneNode(!0),r=n.firstChild,a=r.nextSibling;return a.firstChild,n.$$keydown=e=>{if("Enter"===e.key){if(!Y(e.target,e.currentTarget))return;o()}},n.$$click=e=>{Y(e.target,e.currentTarget)&&o()},n.className="bg-gray-100 border p-4 focus:bg-white focus:shadow-md cursor-pointer hover:bg-white hover:shadow-md outline-default transition handles-clicks",i(r,(()=>t.value.config.title)),i(a,d(J,{get start(){return e.project[1].updated}}),null),n})()}})}function ct(e){const t=y(),[n,a]=r("account"),s=()=>!1!==n(),[l,c]=r(t.currentUser),[u,g]=r(),f=T(t,(e=>{a(!1),console.log("auth_state_changed",e),c(e)}));return o((()=>f())),d(W,{get when(){return"account"!==n()},get fallback(){return(()=>{const e=Re.cloneNode(!0);return i(e,d(vt,{})),e})()},get children(){return[d(K,{get when(){return l()},get fallback(){return[d(tt,{children:"Animator"}),Ae.cloneNode(!0),d(it,{get disabled(){return s()},class:"w-full",style:"gray",onClick:()=>{e.pushPage({kind:"email_account"})},children:"Email Account"}),Ae.cloneNode(!0),d(it,{get disabled(){return s()},class:"w-full",style:"gray",onClick:()=>{e.pushPage({kind:"sample_projects"})},children:"Demo Mode"}),Fe.cloneNode(!0),Oe.cloneNode(!0)]},children:r=>[(()=>{const e=Ue.cloneNode(!0);return e.firstChild,i(e,(()=>r.uid),null),e})(),Ae.cloneNode(!0),d(st,{get pushPage(){return e.pushPage}}),Ae.cloneNode(!0),(()=>{const r=Ee.cloneNode(!0);return i(r,d(it,{get disabled(){return s()},class:"flex-1",style:"gray",onClick:()=>{a("log_out"),$(t).then((()=>{a(!1)})).catch((e=>{a(!1),g(""+e.toString())}))},get children(){return d(W,{get when(){return"log_out"!==n()},get fallback(){return d(vt,{})},children:"Log Out"})}}),null),i(r,d(it,{get disabled(){return s()},class:"flex-1",style:"gray",onClick:()=>{e.pushPage({kind:"sample_projects"})},children:"Demo Mode"}),null),r})()]}),d(K,{get when(){return u()},children:e=>[Se.cloneNode(!0),(()=>{const t=je.cloneNode(!0),n=t.firstChild;return n.firstChild,i(n,e,null),t})()]})]}})}function dt(e){const[t,n]=r([]),a=()=>{var e;const n=t();return null!=(e=n[n.length-1])?e:{kind:"main"}},s=e=>{n((t=>[...t,e]))},l=()=>{n((e=>e.slice(0,e.length-1)))},c=e=>{n((t=>[...t.slice(0,t.length-1),e]))};return d(K,{get when(){return e=a(),t="animator",e.kind===t?e:null;var e,t},get fallback(){return d(wt,{horizontal:!0,get children(){const e=Be.cloneNode(!0),t=e.firstChild;return i(t,d(H,{get item(){return a()},children:{main:()=>d(ct,{pushPage:s,popPage:l}),create_project:()=>d(ot,{replacePage:c,popPage:l}),email_account:()=>d(nt,{pushPage:s,popPage:l,loading:!1}),animator_loader:e=>d(pt,{replacePage:c,popPage:l,get project_id(){return e.project_id}}),sample_projects:()=>d(ut,{popPage:l,pushPage:c}),animator:()=>{throw new Error("never.")}}})),e}})},children:e=>(o((()=>e.cleanup())),d(ye,{get data(){return e.state},get children(){return d(mt,{get state(){return e.state},get children(){return d(oe,{get state(){return e.state},get applyAction(){return e.applyAction}})}})}}))})}function ut(e){const[t,n]=r({kind:"loading"});let a=!0;o((()=>a=!1));return(async()=>{const e=await fetch("/sample-projects/list.json").then((e=>e.json())),t=await Promise.all(e.map((async e=>({config:await fetch("/sample-projects/"+e+"/config.json").then((e=>e.json())),name:e}))));n({kind:"ready",demos:t})})().catch((e=>{h((()=>{n({kind:"error",message:"Failed to load demo mode. Message: "+e.toString()})}))})),[d(at,{get popPage(){return e.popPage}}),d(tt,{children:"Demo Projects"}),Ae.cloneNode(!0),d(H,{get item(){return t()},children:{loading:()=>d(vt,{}),error:e=>(()=>{const t=Ve.cloneNode(!0);return i(t,(()=>e.message)),t})(),ready:t=>[qe.cloneNode(!0),Se.cloneNode(!0),(()=>{const r=He.cloneNode(!0);return i(r,d(m,{get each(){return t.demos},children:t=>(()=>{const r=We.cloneNode(!0),o=r.firstChild,s=o.nextSibling;return s.nextSibling,r.$$keydown=e=>{"Enter"!==e.key||Y(e.target,e.currentTarget)},r.$$click=r=>{var o;Y(r.target,r.currentTarget)&&(o=t,n({kind:"loading"}),(async()=>{const[t,n]=await Promise.all([fetch("/sample-projects/"+o.name+"/actions.json").then((e=>e.json())),fetch("/sample-projects/"+o.name+"/audio.mp3").then((e=>e.arrayBuffer()))]),r=await ft.decodeAudioData(n);if(a){const n=gt(r,o.config,t.actions.map(((e,t)=>({...e,id:""+t,session_id:Qe,insert_time:Date.now()}))),{onAddAction:e=>{n.replaceActions(n.state.actions.length,0,[{...e,insert_time:Date.now()}])}});e.pushPage({kind:"animator",state:n.state,applyAction:n.applyAction,cleanup:()=>{}})}})().catch((e=>{h((()=>{n({kind:"error",message:"Failed to load demo project. Message: "+e.toString()})}))})))},r.className="bg-gray-100 border p-4 focus:bg-white focus:shadow-md cursor-pointer hover:bg-white hover:shadow-md outline-default transition handles-clicks",i(r,d(ht,{get attribution(){return t.config.attribution.author}}),o),i(r,d(ht,{get attribution(){return t.config.attribution.title}}),s),i(r,d(ht,{get attribution(){return t.config.attribution.license}}),null),r})()})),r})()]}})]}function gt(e,t,n,o){const[i,a]=r(n),[s,l]=r(Q(n,{last_action_time:0,frames:{0:{merged_polygons:[],thumbnail:[]}}},[],[],t)),[c,d]=r(0),[u,g]=r(0),f=Math.ceil(e.duration*t.framerate),p=new Float32Array(e.getChannelData(0)),m={get actions(){return i()},get cached_state(){return s()},get update_time(){return c()},get frame(){return u()},get max_frame(){return f},get config(){return t},get audio(){return e},audio_ctx:ft,get audio_data(){return p}},w=(e,n,r)=>{const o=Date.now(),c=i(),u=c.filter(((t,n)=>n<e)),g=c.filter(((t,r)=>r>=e+n)),f=c.filter(((t,r)=>r>=e&&r<e+n)),p=Q([...r,...f.map((e=>({id:rt(),session_id:Qe,insert_time:1/0,kind:"invalidate_action",frame:e.frame,invalidate:{id:e.id,time:e.insert_time}})))],s(),u,g,t);h((()=>{a([...u,...r,...g]),l(p);const e=Date.now();d(e-o)}))};let v=[];const y=e=>{h((()=>{if("undo"===e.kind){const e=new Set;let t;for(const n of[...m.actions].reverse())if(!e.has(n.id))if("invalidate_action"!==n.kind){if(n.session_id===Qe){t=n;break}}else e.add(n.invalidate.id);t&&(v.push(t),g(t.frame),o.onAddAction({id:rt(),session_id:Qe,kind:"invalidate_action",frame:t.frame,invalidate:{id:t.id,time:t.insert_time}}))}else if("redo"===e.kind){const e=v.pop();e&&o.onAddAction({...e,id:rt(),session_id:Qe})}else if("set_frame"===e.kind)g(Math.min(m.max_frame,Math.max(0,e.frame)));else{v=[];const t={...e,id:rt(),session_id:Qe};o.onAddAction(t)}}))};return window.animator={state:m,applyAction:y,replaceActions:w},{state:m,applyAction:y,replaceActions:w}}const ft=new AudioContext;function pt(e){const t=w(),n=v(),a=y();let s=!0;o((()=>s=!1));const[l,c]=r(),[u,g]=r("Starting"),f=b(_(t,"/actions/"+e.project_id),x("created")),p=[];return async function(){g("Fetching Project");const r=_(t,"/projects/"+e.project_id),o=(await C(r)).val();if(!s)throw new Error("canceled");g("Fetching Audio");const i=S(n,o.config.audio),l=await D(i),c=await fetch(l).then((e=>e.arrayBuffer()));if(!s)throw new Error("canceled");g("Initializing Audio");const d=await ft.decodeAudioData(c);if(!s)throw new Error("canceled");g("Initializing App");const u=gt(d,o.config,[],{onAddAction:n=>{console.log("adding action",n);const r=_(t,"/actions/"+e.project_id+"/"+n.id);P(r,{created:j(),author:a.currentUser.uid,value:n}).then((e=>{console.log("action set ✓")})).catch((e=>{console.log("failed to save action",n,e),alert("error saving action")}))}});if(!s)throw new Error("canceled");g("Downloading Actions");let h=!0;if(p.push(L(f,(e=>{if(h)return;const t=e.val(),n=t.value;console.log("\\!/ added action",t);let r=u.state.actions.findIndex((e=>t.created<e.insert_time));-1===r&&(r=u.state.actions.length),console.log("NEW ACTION ADDED AT INDEX,",r,t),u.replaceActions(r,0,[{...n,id:e.key,insert_time:t.created}])}))),p.push(M(f,(e=>{console.log("changed action",e)}))),p.push(I(f,(e=>{const t=e.val(),n=t.value;console.log("firebase noted action removal ",e.key,t,"; patching local data");const r=u.state.actions.findIndex((t=>t.id===e.key));if(-1===r)return console.error("attempting to remove nonexistent action",e.key,n);u.replaceActions(r,1,[])}))),await new Promise(((e,t)=>{const n=z(f,(r=>{try{n(),h=!1,g("Initializing Actions");const t=[];r.exists()&&r.forEach((e=>{const n=e.val(),r=n.value;t.push({...r,id:e.key,insert_time:n.created})})),u.replaceActions(0,u.state.actions.length,t),e()}catch(o){t(o)}}),(e=>{n(),t(e)}))})),!s)throw new Error("canceled");if(g("Starting"),!s)throw new Error("canceled");e.replacePage({kind:"animator",state:u.state,applyAction:u.applyAction,cleanup:()=>p.forEach((e=>e()))})}().catch((e=>{console.log(e),c(e.toString()),p.forEach((e=>e()))})),[d(at,{get popPage(){return e.popPage}}),d(K,{get when(){return l()},get fallback(){return(()=>{const e=Ke.cloneNode(!0),t=e.firstChild,n=t.nextSibling;return n.nextSibling,i(e,d(vt,{}),t),i(e,u,n),e})()},children:e=>(()=>{const t=Ye.cloneNode(!0),n=t.firstChild.nextSibling;return n.nextSibling,i(t,u,n),i(t,e,null),t})()})]}function ht(e){return(()=>{const t=Ge.cloneNode(!0);return i(t,(()=>e.attribution.text)),a((()=>s(t,"href",e.attribution.url))),t})()}function mt(e){const[t,n]=r(window.__audio_initialized),[o,s]=r(!1);return d(W,{get when(){return t()},get fallback(){return(()=>{const t=Je.cloneNode(!0),r=t.firstChild;return t.$$click=()=>{const t=e.state.audio_ctx.createBufferSource();t.buffer=e.state.audio,t.connect(e.state.audio_ctx.destination),t.start(0,0,.2),s(!0),t.addEventListener("ended",(()=>{window.__audio_initialized=!0,s(!1),n(!0)}))},r.className="border px-4 py-2 shadow-md bg-white transform hover:scale-110 hover:shadow-lg transition sm:min-w-max sm:w-30 ",i(r,d(W,{get when(){return!o()},get fallback(){return d(vt,{})},children:"Start"})),a((()=>t.disabled=o())),t})()},get children(){return e.children}})}function wt(e){return(()=>{const t=_e.cloneNode(!0);return i(t,(()=>e.children)),a((()=>t.className="min-h-full flex flex-col flex-wrap items-center bg-gray-100"+(!0===e.horizontal?"":" justify-center"))),t})()}function vt(){return(()=>{const e=Xe.cloneNode(!0),t=e.firstChild.nextSibling.nextSibling;return s(t,"d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"),e})()}function yt(){return d(dt,{})}function bt(e){const[t,n]=R({kind:"loading"});console.log("waiting for",e);const r=z(e,(e=>{console.log("got value",e);const t=e.val();n(F({kind:"loaded",value:t},{merge:!0}))}),(e=>{console.log(e),n(F({kind:"error",message:e.toString()},{merge:!0}))}));return o((()=>r())),[t]}console.log("hmr reload"),f(["input","keydown","click"]),O({apiKey:"AIzaSyAJ3J40bR4cGKRrhQdsGE5W-aRSc6RbFBc",authDomain:"animator-9443f.firebaseapp.com",databaseURL:"https://animator-9443f-default-rtdb.firebaseio.com",storageBucket:"animator-9443f.appspot.com"}),U((()=>d(ye,{data:0,get children(){return d(yt,{})}})),document.getElementById("app"));
