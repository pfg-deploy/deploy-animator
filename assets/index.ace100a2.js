import{t as e,c as t,u as n,a as r,o,i as a,b as i,s as l,d as s,e as c,f as d,g as u,h as g,k as f,j as p,E as m,F as h,l as w,m as v,n as y,p as b,q as x,r as _,v as k,w as N,x as j,y as P,z as S,A as T,B as $,C,D as E,G as A,H as D,I as L,J as M,K as z}from"./vendor.9380fdd8.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();function I(e,t){var n,r;const o=null!=(r=null!=(n=t[e.kind])?n:t.unsupported)?r:()=>{throw new Error("condition "+e.kind+" was not handled and no unsupported branch")};return()=>o(e)}function R(e,t){return I(e,t)()}const F=e("<time></time>");function B(e){return t((()=>I(e.item,e.children)()))}function O(e){const n=t((()=>e.when),void 0,{equals:(e,t)=>!e==!t});return t((()=>n()?e.children:e.fallback))}function U(e){return t((()=>{var t,r;if((null==(r=null==(t=e.if)?void 0:t[0])||r)&&null!=e.when){const t=e.children;return n((()=>t(e.when)))}return e.fallback}))}function q(e,t){const n=document.getSelection();if(!1===(null==n?void 0:n.isCollapsed))return!1;let r=e;for(;r&&r!==t;){if(r instanceof HTMLElement&&("A"===r.nodeName||"BUTTON"===r.nodeName||"VIDEO"===r.nodeName||"AUDIO"===r.nodeName||"INPUT"===r.nodeName||"TEXTAREA"===r.nodeName||"IFRAME"===r.nodeName||r.classList.contains("resizable-iframe")||r.classList.contains("handles-clicks")))return!1;r=r.parentNode}return!0}function V(e,t){if(!t.endsWith("s"))throw new Error("!s");return 1===e?e+t.substring(0,t.length-1):e+t}function X(e){const[n,s]=r(Date.now()),c=t((()=>{const t=function(e,t){const n=t-e;if(n<0)return["in the future "+new Date(e).toISOString(),-n];if(n<6e4)return["just now",6e4-n];let r=6e4,o=60;if(n<o*r){const e=n/r|0;return[V(e," minutes")+" ago",r-(n-e*r)]}if(r*=o,o=24,n<o*r){const e=n/r|0;return[V(e," hours")+" ago",r-(n-e*r)]}if(r*=o,o=30,n<o*r){const e=n/r|0;return[V(e," days")+" ago",r-(n-e*r)]}return[new Date(e).toISOString(),-1]}(e.start,n());if(t[1]>0){const e=setTimeout((()=>s(Date.now())),Math.min(t[1]+10,2147483647));o((()=>clearTimeout(e)))}return t[0]}));return(()=>{const t=F.cloneNode(!0);return a(t,c),i((n=>{const r=new Date(e.start).toString(),o=""+new Date(e.start);return r!==n._v$&&l(t,"datetime",n._v$=r),o!==n._v$2&&l(t,"title",n._v$2=o),n}),{_v$:void 0,_v$2:void 0}),t})()}let Y=function(e,t){for(const n of Object.keys(t.frames).reverse()){const t=+n;if(e>=t)return t}throw new Error("requested frame "+e+" not found. note: the zero frame is required to exist.")},H=function(e,t,n){const r=new Set;let o=t;for(const a of e)o=R(a,{add_polygon:e=>{var t;const n=null!=(t=o.frames[e.frame])?t:{merged_polygons:[],thumbnail:[]};r.add(e.frame);const a=s.union(n.merged_polygons,[e.polygon]),i={...n,merged_polygons:a};return{...o,frames:{...o.frames,[e.frame]:i}}},erase_polygon:e=>{var t;const n=null!=(t=o.frames[e.frame])?t:{merged_polygons:[],thumbnail:[]};r.add(e.frame);const a=s.difference(n.merged_polygons,[e.polygon]),i={...n,merged_polygons:a};return{...o,frames:{...o.frames,[e.frame]:i}}}});for(const a of r){const e=o.frames[a];if(!e)continue;const t={...e,thumbnail:K(e.merged_polygons,n)};o={...o,frames:{...o.frames,[a]:t}}}return o};function K(e,t){return c({type:"Feature",geometry:{type:"MultiPolygon",coordinates:e}},Math.min(t.width,t.height)/50).geometry.coordinates}const W=e('<div class="h-full"></div>'),G=e('<canvas class="w-full h-full fixed top-0 left-0 bottom-0 right-0"></canvas>');function J(e){return document.documentElement.classList.add("no-interact"),o((()=>document.documentElement.classList.remove("no-interact"))),(()=>{const t=W.cloneNode(!0);return a(t,d(Q,{get state(){return e.state},get applyAction(){return e.applyAction}}),null),a(t,d(oe,{get state(){return e.state},get applyAction(){return e.applyAction}}),null),t})()}function Q(e){return d(le,{render:(t,n)=>{const r=Date.now();t.fillStyle="#ffffff",t.fillRect(0,0,n.width,n.height);const o=ee();let a=e.state.frame;null!=o&&(a=o);const i=Y(a,e.state.cached_state),l=e.state.cached_state.frames[i],s=i===a||null!=o;t.fillStyle=s?"#000000":"#555555",ae(t,l.merged_polygons);const c=Date.now();t.fillStyle="#000000",t.fillText("Last Update ms: "+e.state.update_time,10,20),t.fillText("Draw ms: "+(c-r),10,30),t.fillText("Vertices: "+l.merged_polygons.reduce(((e,t)=>e+t.reduce(((e,t)=>e+t.length),0)),0),10,40),t.fillText("Frame: "+a+" / "+e.state.max_frame,10,50),t.fillText("Project: "+e.state.config.title,10,60)}})}let Z=null;const[ee,te]=r(null);function ne(e,t){e.source.addEventListener("ended",(()=>{}));const n=()=>Z?(te((Z.offset+Z.context.currentTime)*t|0),!0):(te(null),!1);n(),function(e){const t=()=>requestAnimationFrame((()=>{e()&&t()}));t()}(n)}function re(){Z&&(Z.source.stop(),Z=null)}function oe(e){const[n,a]=r(new Map),i=e=>f(e,{simulatePressure:e.every((e=>.5===e[2]))}),l=e=>[e.pageX,e.pageY,e.pressure],s=new Map,c=e=>{const t=s.get(e);if(!t||0===t.points.size){const t={points:new Map,mode:{kind:"draw"}};return s.set(e,t),t}return t},u=()=>{let t=e.state.frame/e.state.config.framerate;t<0&&(t=0),t>e.state.audio.duration&&(t=e.state.audio.duration);const n=e.state.audio_ctx.createBufferSource();n.buffer=e.state.audio,n.connect(e.state.audio_ctx.destination),n.playbackRate.setValueAtTime(1,0),n.start(0,t,e.state.audio.duration-t),function(e,t){re(),Z={...e,offset:e.offset-e.context.currentTime},ne(e,t)}({source:n,offset:t,context:e.state.audio_ctx},e.state.config.framerate)},p=t=>{t.preventDefault();const n=c(t.pointerType);if(n.points.set(t.pointerId,{start:Date.now(),point:l(t)}),"touch"===t.pointerType&&n.points.size>1){if("zoom"===n.mode.kind||[...n.points.values()][0].start<Date.now()-200)return void n.points.delete(t.pointerId);n.mode={kind:"zoom"},a((e=>{const n=new Map(e);return n.delete(t.pointerType),n})),e.applyAction({kind:"undo"});const r=[...n.points.values()];if(r.length<2)return;return r[0].point[0],r[0].point[1],r[1].point[0],void r[1].point[1]}if(t.pageY>window.innerHeight-200)return n.mode={kind:"switch_frame",start_x:t.pageX},void u();a((e=>new Map(e).set(t.pointerType,[l(t)])))};document.addEventListener("pointerdown",p),o((()=>document.removeEventListener("pointerdown",p)));const[m,h]=r(0),w=t=>{const n=c(t.pointerType),r=n.points.get(t.pointerId);if(r){if(t.preventDefault(),r.point=l(t),"touch"===t.pointerType&&"zoom"===n.mode.kind){const e=[...n.points.values()];if(e.length<2)return;return e[0].point[0],e[0].point[1],e[1].point[0],void e[1].point[1]}if("switch_frame"===n.mode.kind){const r=e.state.frame;for(;t.pageX<n.mode.start_x-20;)e.applyAction({kind:"set_frame",frame:e.state.frame+1}),n.mode.start_x-=20;for(;t.pageX>n.mode.start_x+20;)e.applyAction({kind:"set_frame",frame:e.state.frame-1}),n.mode.start_x+=20;const o=(t.pageX-n.mode.start_x+20)/40,a=.3,i=50;return h(o**a/(o**a+(1-o)**a)*(2*i)-i),void(e.state.frame!==r&&u())}a((e=>{var n;return new Map(e).set(t.pointerType,[...null!=(n=e.get(t.pointerType))?n:[],l(t)])}))}};document.addEventListener("pointermove",w),o((()=>document.removeEventListener("pointermove",w)));const v=t=>{var r;t.preventDefault();const o=c(t.pointerType);if(!o.points.has(t.pointerId))return;if(o.points.delete(t.pointerId),"touch"===t.pointerType&&"zoom"===o.mode.kind)return void o.points.size;if("switch_frame"===o.mode.kind)return re(),void h(0);const l=null!=(r=n().get(t.pointerType))?r:[];g((()=>{a((e=>{const n=new Map(e);return n.delete(t.pointerType),n}));const n=i(l);n.some((e=>isNaN(e[0])||isNaN(e[1])))||e.applyAction({kind:"touch"===t.pointerType||2===t.button?"erase_polygon":"add_polygon",polygon:n,frame:e.state.frame})}))};document.addEventListener("pointerup",v),o((()=>document.removeEventListener("pointerup",v)));const y=e=>{const t=c(e.pointerType);t.points.has(e.pointerId)&&(t.points.delete(e.pointerId),"touch"===e.pointerType&&"zoom"===t.mode.kind||("switch_frame"!==t.mode.kind?a((t=>{const n=new Map(t);return n.delete(e.pointerType),n})):h(0)))};document.addEventListener("pointercancel",y),o((()=>document.removeEventListener("pointercancel",y)));const b=e=>{e.preventDefault()};document.addEventListener("contextmenu",b),o((()=>document.removeEventListener("pointercancel",b)));const x=t((()=>[...n().values()].map(i)));return d(le,{render:(t,n)=>{var r;const o=Date.now();t.fillStyle="#000";for(const e of x()){t.beginPath();let n=!0;for(const[r,o]of e)n?(t.moveTo(r,o),n=!1):t.lineTo(r,o);t.fill()}t.fillStyle="#aaa",t.fillRect(0,n.height-200,n.width,200);for(let s=-5;s<5;s++){const r=s+e.state.frame;if(r<0)continue;const o=Y(r,e.state.cached_state),a=o===r,i=e.state.cached_state.frames[o].thumbnail;if(t.save(),t.translate(n.width/2-90+250*s,n.height-200+45),t.scale(.1,.1),0===s){t.fillStyle="#999";const n=100,r=440;t.fillRect(-n,-r,e.state.config.width+2*n,e.state.config.height+2*r)}t.translate(m()/.1,0),t.fillStyle="#fff",t.fillRect(0,0,e.state.config.width,e.state.config.height),t.fillStyle=a?"#000":"#888",ae(t,i),t.restore()}t.fillStyle="#000";const a=e.state.audio_data,i=e.state.frame/e.state.config.framerate*e.state.audio.sampleRate|0;for(let e=0;e<15;e++)t.fillText(""+Math.abs(null!=(r=a[i+e])?r:0),10,n.height-200+10*(e+5));const l=Date.now();t.fillText("Draw ms: "+(l-o),10,n.height-200+20),t.fillText("Frame: "+e.state.frame+" / "+e.state.max_frame,10,n.height-200+30)}})}function ae(e,t){for(const n of t)ie(e,n)}function ie(e,t){e.beginPath();for(const n of t){let t=!0;for(const[r,o]of n)t?(e.moveTo(r,o),t=!1):e.lineTo(r,o)}e.fill()}function le(e){const t=()=>({width:window.innerWidth,height:window.innerHeight}),[n,a]=r(t()),i=()=>{a(t())};return window.addEventListener("resize",i),o((()=>window.removeEventListener("resize",i))),(()=>{const t=G.cloneNode(!0);return(t=>{const r=t.getContext("2d");u((()=>{const o=n(),a=window.devicePixelRatio;t.width!==o.width*a&&(t.width=o.width*a),t.height!==o.height*a&&(t.height=o.height*a),r.setTransform((new DOMMatrixReadOnly).scale(a)),null==r||r.clearRect(0,0,o.width,o.height),e.render(r,o)}))})(t),t})()}const se=e('<div class="min-h-full p-4 bg-red-900 text-white"><button class="border px-2">Code</button> / <button class="border px-2">Retry</button><pre class="whitespace-pre-wrap"><code> </code></pre></div>');function ce(e){const[t,n]=r(!0);return d(m,{fallback:(t,r)=>(console.log(t),(()=>{const o=se.cloneNode(!0),a=o.firstChild,l=a.nextSibling.nextSibling,s=l.nextSibling.firstChild.firstChild;return a.$$click=()=>console.log(t,e.data),l.$$click=()=>{n(!1),setTimeout((()=>n(!0)),200),r()},i((()=>s.data=t instanceof Error?t.toString()+"\n\n"+t.stack:"Something went wrong")),o})()),get children(){return d(O,{get when(){return t()},get fallback(){return"Retrying..."},get children(){return e.children}})}})}p(["click"]);const de=e('<label><div class="text-sm text-gray-800">:</div></label>'),ue=e("<input>"),ge=e("<div></div>"),fe=e('<div role="heading" class="text-3xl font-black"></div>'),pe=e("<hr>"),me=e('<div class="pb-4"></div>'),he=e('<div class="pb-2"></div>'),we=e('<div class="flex flex-row flex-wrap gap-4 <sm:flex-col"></div>'),ve=e('<p class="text-sm text-gray-700"><span class="text-red-600">Error! </span></p>'),ye=e('<input type="file">'),be=e('<ul class="text-red-600"></ul>'),xe=e("<li></li>"),_e=e("<button></button>"),ke=e('<button class="text-blue-600 bg-blue-100 hover:bg-blue-200 transition px-1">&lt; Back</button>'),Ne=e('<div class="flex flex-col gap-2"></div>'),je=e('<p class="text-sm text-gray-700">You don\'t have any projects.</p>'),Pe=e('<p class="text-sm text-red-600">Error: </p>'),Se=e('<div tabindex="0"><div></div><div class="text-sm font-light">Updated </div></div>'),Te=e('<div class="flex flex-row justify-center"></div>'),$e=e('<div class="pb-1"></div>'),Ce=e('<p class="text-sm text-gray-700">Note: Saving animations has not yet been implemented. Your animations will not be saved.</p>'),Ee=e('<p class="text-sm text-gray-700">Note: In demo mode, you cannot save your animations.</p>'),Ae=e("<div>You are signed in as </div>"),De=e('<div class="w-full max-w-md py-50"><div class="p-4 shadow-md bg-white border"></div></div>'),Le=e('<p class="text-red-600"></p>'),Me=e('<p class="text-base text-red-600">Your work will not be saved.</p>'),ze=e('<ul class="flex flex-col gap-2"></ul>'),Ie=e('<li tabindex="0"> - <!> / </li>'),Re=e("<div> <!>…</div>"),Fe=e('<p class="text-sm text-red-600">Error while <!>: </p>'),Be=e('<a class="underline underline-dotted hover:underline-solid" target="_blank" rel="noopener noreferrer"></a>'),Oe=e('<button class="w-full h-full flex flex-col flex-wrap items-center justify-center bg-gray-100"><span></span></button>'),Ue=e('<svg class="animate-spin mr-1 h-5 w-5 text-black inline-block align-middle" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><title>Loading…</title><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor"></path></svg>');function qe(e){return(()=>{const t=de.cloneNode(!0),n=t.firstChild,r=n.firstChild;return a(n,(()=>e.text),r),a(t,(()=>e.children),null),t})()}function Ve(e){return(()=>{const t=ge.cloneNode(!0);return a(t,d(qe,{get text(){return e.label},get children(){const t=ue.cloneNode(!0);return t.$$keydown=t=>{"Enter"===t.code&&(e.disabled||(t.preventDefault(),e.onenter()))},t.$$input=t=>{e.setValue(t.currentTarget.value)},i((n=>{const r=e.type,o="border px-3 py-2 block w-full "+(e.disabled?"text-gray-700 bg-gray-100 cursor-not-allowed":""),a=e.disabled,i=e.placeholder,s=e.value;return r!==n._v$&&l(t,"type",n._v$=r),o!==n._v$2&&(t.className=n._v$2=o),a!==n._v$3&&(t.disabled=n._v$3=a),i!==n._v$4&&l(t,"placeholder",n._v$4=i),s!==n._v$5&&(t.value=n._v$5=s),n}),{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0}),t}})),t})()}function Xe(e){return[(()=>{const t=fe.cloneNode(!0);return a(t,(()=>e.children)),t})(),pe.cloneNode(!0)]}function Ye(e){const[t,n]=r(""),[o,i]=r(""),[l,s]=r(!1),[c,u]=r(void 0),g=()=>e.loading||!1!==l(),f=y(),p=w();async function m(e){const t={created:P(),projects:{}},n=k(p,"/users/"+e);null==(await A(n)).val()&&await S(n,t)}function h(t){t.then((()=>{e.popPage()})).catch((e=>{s(!1),console.log(e),u(""+e.toString())}))}return[d(We,{get popPage(){return e.popPage}}),d(Xe,{children:"Email Account"}),me.cloneNode(!0),d(Ve,{type:"email",label:"Email",placeholder:"name@example.com",get disabled(){return g()},get value(){return t()},setValue:n,onenter:()=>{}}),he.cloneNode(!0),d(Ve,{type:"password",label:"Password",get disabled(){return g()},get value(){return o()},setValue:i,onenter:()=>{}}),me.cloneNode(!0),(()=>{const e=we.cloneNode(!0);return a(e,d(Ke,{style:"gray",class:"flex-1",get disabled(){return g()},onClick:()=>{s("create_account"),h((async()=>{const e=await b(f,t(),o());await m(e.user.uid)})())},get children(){return d(O,{get when(){return"create_account"===l()},get fallback(){return"Create Account"},get children(){return d(lt,{})}})}}),null),a(e,d(Ke,{style:"green",class:"sm:min-w-max sm:w-30",get disabled(){return g()},onClick:()=>{s("log_in"),h((async()=>{const e=await x(f,t(),o());await m(e.user.uid)})())},get children(){return d(O,{get when(){return"log_in"===l()},get fallback(){return"Log In"},get children(){return d(lt,{})}})}}),null),e})(),d(U,{get when(){return c()},children:e=>[he.cloneNode(!0),(()=>{const t=ve.cloneNode(!0),n=t.firstChild;return n.firstChild,a(n,e,null),t})()]})]}function He(e){const[t,n]=r(!1),[o,l]=r(""),[s,c]=r(null),[u,g]=r(""),[f,p]=r(""),m=w(),b=y(),x=v(),T=_(k(m,"/projects")),$=T.key,C=k(m,"/users/"+b.currentUser.uid+"/projects/"+$),E=N(x,"/user/"+b.currentUser.uid+"/"+function(){const e=w();return _(k(e,"/_")).key}()),A=()=>+u(),D=()=>{const e=f().split("x");return 2!==e.length?[0,0]:[+e[0],+e[1]]},L=()=>{const e=[];return o().trim()||e.push("Name required"),s()?1!==s().length?e.push("Max one audio file"):s().item(0).name.endsWith(".mp3")||e.push("Audio file must be .mp3"):e.push("Audio required"),A()||e.push("FPS required"),D().some((e=>!e))&&e.push("Size required"),e};return[d(We,{get popPage(){return e.popPage}}),d(Xe,{children:"Create Project"}),me.cloneNode(!0),d(Ve,{type:"text",label:"Project Name",get disabled(){return!1!==t()},get value(){return o()},setValue:l,onenter:()=>{}}),he.cloneNode(!0),d(qe,{text:"Audio",get children(){const e=ye.cloneNode(!0);return e.$$input=e=>{c(e.currentTarget.files)},i((()=>e.disabled=!1!==t())),e}}),he.cloneNode(!0),d(Ve,{type:"text",label:"Frames per Second",placeholder:"15",get disabled(){return!1!==t()},get value(){return u()},setValue:g,onenter:()=>{}}),he.cloneNode(!0),d(Ve,{type:"text",label:"Size",placeholder:"1920x1080",get disabled(){return!1!==t()},get value(){return f()},setValue:p,onenter:()=>{}}),me.cloneNode(!0),d(Ke,{class:"w-full",style:"green",get disabled(){return 0!==L().length||"create_project"===t()},onClick:()=>{if(0!==L().length)return alert("unresolved errors");n("create_project");const t=s().item(0);(async()=>{const e=N(E,"/"+t.name),n=await j(e,await t.arrayBuffer());console.log(n.metadata.fullPath);const r={created:P(),owner:b.currentUser.uid,config:{title:o(),audio:n.metadata.fullPath,framerate:A(),width:D()[0],height:D()[1]}},a={updated:P()};console.log("creating project",r),await S(T,r),await S(C,a)})().then((t=>{n(!1),e.replacePage({kind:"animator_loader",project_id:$})})).catch((e=>{n(!1),console.log(e),alert("error creating project: "+e.toString())}))},get children(){return d(O,{get when(){return"create_project"!==t()},get fallback(){return d(lt,{})},children:"Create Project"})}}),(()=>{const e=be.cloneNode(!0);return a(e,d(h,{get each(){return L()},children:e=>(()=>{const t=xe.cloneNode(!0);return a(t,e),t})()})),e})()]}function Ke(e){return(()=>{const t=_e.cloneNode(!0);return t.$$click=()=>e.onClick(),a(t,(()=>e.children)),i((()=>t.className="border px-4 py-2 block "+e.class+" "+{gray:()=>{var t;return"transition "+(null!=(t=e.disabled)&&t?"text-gray-700 bg-gray-100 cursor-not-allowed":"bg-gray-200 hover:shadow-md hover:bg-white")},green:()=>{var t;return null!=(t=e.disabled)&&t?"text-gray-700 bg-gray-100 cursor-not-allowed":"border-green-400 bg-gradient-to-r from-green-400 to-green-500 text-white font-bold hover:shadow-md"}}[e.style]())),t})()}function We(e){return(()=>{const t=ke.cloneNode(!0);return t.$$click=()=>{e.popPage()},t})()}function Ge(e){const t=w(),n=y(),r=k(t,"/users/"+n.currentUser.uid),[o]=ct(r);return[d(Ke,{class:"w-full",style:"gray",onClick:()=>{e.pushPage({kind:"create_project"})},children:"+ Create Project"}),me.cloneNode(!0),d(B,{item:o,children:{loading:()=>d(lt,{}),error:e=>(()=>{const t=ve.cloneNode(!0),n=t.firstChild;return n.firstChild,a(n,(()=>e.message),null),t})(),loaded:t=>(()=>{const n=Ne.cloneNode(!0);return a(n,d(h,{get each(){var e;return Object.entries(null!=(e=t.value.projects)?e:{})},get fallback(){return je.cloneNode(!0)},children:t=>d(Je,{get pushPage(){return e.pushPage},project:t})})),n})()}})]}function Je(e){const t=w(),n=k(t,"/projects/"+e.project[0]),[r]=ct(n),o=()=>{e.pushPage({kind:"animator_loader",project_id:e.project[0]})};return d(B,{item:r,children:{loading:()=>d(lt,{}),error:e=>(()=>{const t=Pe.cloneNode(!0);return t.firstChild,a(t,(()=>e.message),null),t})(),loaded:t=>(()=>{const n=Se.cloneNode(!0),r=n.firstChild,i=r.nextSibling;return i.firstChild,n.$$keydown=e=>{if("Enter"===e.key){if(!q(e.target,e.currentTarget))return;o()}},n.$$click=e=>{q(e.target,e.currentTarget)&&o()},n.className="bg-gray-100 border p-4 focus:bg-white focus:shadow-md cursor-pointer hover:bg-white hover:shadow-md outline-default transition handles-clicks",a(r,(()=>t.value.config.title)),a(i,d(X,{get start(){return e.project[1].updated}}),null),n})()}})}function Qe(e){const t=y(),[n,i]=r("account"),l=()=>!1!==n(),[s,c]=r(t.currentUser),[u,g]=r(),f=T(t,(e=>{i(!1),console.log("auth_state_changed",e),c(e)}));return o((()=>f())),d(O,{get when(){return"account"!==n()},get fallback(){return(()=>{const e=Te.cloneNode(!0);return a(e,d(lt,{})),e})()},get children(){return[d(U,{get when(){return s()},get fallback(){return[d(Xe,{children:"Animator"}),me.cloneNode(!0),d(Ke,{get disabled(){return l()},class:"w-full",style:"gray",onClick:()=>{e.pushPage({kind:"email_account"})},children:"Email Account"}),$e.cloneNode(!0),Ce.cloneNode(!0),me.cloneNode(!0),d(Ke,{get disabled(){return l()},class:"w-full",style:"gray",onClick:()=>{e.pushPage({kind:"sample_projects"})},children:"Demo Mode"}),$e.cloneNode(!0),Ee.cloneNode(!0)]},children:r=>[(()=>{const e=Ae.cloneNode(!0);return e.firstChild,a(e,(()=>r.uid),null),e})(),me.cloneNode(!0),d(Ge,{get pushPage(){return e.pushPage}}),me.cloneNode(!0),d(Ke,{get disabled(){return l()},class:"w-full",style:"gray",onClick:()=>{i("log_out"),$(t).then((()=>{i(!1)})).catch((e=>{i(!1),g(""+e.toString())}))},get children(){return d(O,{get when(){return"log_out"!==n()},get fallback(){return d(lt,{})},children:"Log Out"})}})]}),d(U,{get when(){return u()},children:e=>[he.cloneNode(!0),(()=>{const t=ve.cloneNode(!0),n=t.firstChild;return n.firstChild,a(n,e,null),t})()]})]}})}function Ze(e){const[t,n]=r([]),o=()=>{var e;const n=t();return null!=(e=n[n.length-1])?e:{kind:"main"}},i=e=>{n((t=>[...t,e]))},l=()=>{n((e=>e.slice(0,e.length-1)))},s=e=>{n((t=>[...t.slice(0,t.length-1),e]))};return d(U,{get when(){return e=o(),t="animator",e.kind===t?e:null;var e,t},get fallback(){return d(it,{horizontal:!0,get children(){const e=De.cloneNode(!0),t=e.firstChild;return a(t,d(B,{get item(){return o()},children:{main:()=>d(Qe,{pushPage:i,popPage:l}),create_project:()=>d(He,{replacePage:s,popPage:l}),email_account:()=>d(Ye,{pushPage:i,popPage:l,loading:!1}),animator_loader:e=>d(rt,{replacePage:s,popPage:l,get project_id(){return e.project_id}}),sample_projects:()=>d(et,{popPage:l,pushPage:s}),animator:()=>{throw new Error("never.")}}})),e}})},children:e=>d(ce,{get data(){return e.state},get children(){return d(at,{get state(){return e.state},get children(){return d(J,{get state(){return e.state},get applyAction(){return e.applyAction}})}})}})})}function et(e){const[t,n]=r({kind:"loading"});let i=!0;o((()=>i=!1));return(async()=>{const e=await fetch("/sample-projects/list.json").then((e=>e.json())),t=await Promise.all(e.map((async e=>({config:await fetch("/sample-projects/"+e+"/config.json").then((e=>e.json())),name:e}))));n({kind:"ready",demos:t})})().catch((e=>{g((()=>{n({kind:"error",message:"Failed to load demo mode. Message: "+e.toString()})}))})),[d(We,{get popPage(){return e.popPage}}),d(Xe,{children:"Demo Projects"}),me.cloneNode(!0),d(B,{get item(){return t()},children:{loading:()=>d(lt,{}),error:e=>(()=>{const t=Le.cloneNode(!0);return a(t,(()=>e.message)),t})(),ready:t=>[Me.cloneNode(!0),he.cloneNode(!0),(()=>{const r=ze.cloneNode(!0);return a(r,d(h,{get each(){return t.demos},children:t=>(()=>{const r=Ie.cloneNode(!0),o=r.firstChild,l=o.nextSibling;return l.nextSibling,r.$$keydown=e=>{"Enter"!==e.key||q(e.target,e.currentTarget)},r.$$click=r=>{var o;q(r.target,r.currentTarget)&&(o=t,n({kind:"loading"}),(async()=>{const[t,n]=await Promise.all([fetch("/sample-projects/"+o.name+"/actions.json").then((e=>e.json())),fetch("/sample-projects/"+o.name+"/audio.mp3").then((e=>e.arrayBuffer()))]),r=await nt.decodeAudioData(n);i&&e.pushPage({kind:"animator",...tt(r,o.config,t.actions)})})().catch((e=>{g((()=>{n({kind:"error",message:"Failed to load demo project. Message: "+e.toString()})}))})))},r.className="bg-gray-100 border p-4 focus:bg-white focus:shadow-md cursor-pointer hover:bg-white hover:shadow-md outline-default transition handles-clicks",a(r,d(ot,{get attribution(){return t.config.attribution.author}}),o),a(r,d(ot,{get attribution(){return t.config.attribution.title}}),l),a(r,d(ot,{get attribution(){return t.config.attribution.license}}),null),r})()})),r})()]}})]}function tt(e,t,n){const[o,a]=r(n),[i,l]=C(H(n,{frames:{0:{merged_polygons:[],thumbnail:[]}}},t)),[s,c]=r(0),[d,u]=r(0),f=Math.ceil(e.duration*t.framerate),p=new Float32Array(e.getChannelData(0)),m={get actions(){return o()},cached_state:i,get update_time(){return s()},get frame(){return d()},get max_frame(){return f},get config(){return t},get audio(){return e},audio_ctx:nt,get audio_data(){return p}};return{state:m,applyAction:e=>{g((()=>{const t=Date.now();if("undo"===e.kind){const e=m.actions[m.actions.length-1],t=[...m.actions.slice(0,m.actions.length-1)];a(t),e&&R(e,{add_polygon:e=>u(e.frame),erase_polygon:e=>u(e.frame)});const n=H(t,{frames:{0:{merged_polygons:[],thumbnail:[]}}},m.config);l(E(n,{merge:!0}))}else if("set_frame"===e.kind)u(Math.min(m.max_frame,Math.max(0,e.frame)));else{a((t=>[...t,e]));const t=H([e],m.cached_state,m.config);l(E(t,{merge:!0}))}c(Date.now()-t)}))}}}const nt=new AudioContext;function rt(e){const t=w(),n=v();let i=!0;o((()=>i=!1));const[l,s]=r(),[c,u]=r("Starting");return async function(){var r;u("Fetching Project");const o=k(t,"/projects/"+e.project_id),a=(await A(o)).val();if(!i)return;u("Fetching Audio");const l=N(n,a.config.audio),s=await D(l),c=await fetch(s).then((e=>e.arrayBuffer()));if(!i)return;u("Fetching Actions");const d=k(t,"/actions/"+e.project_id),g=await A(d),f=Object.values(null!=(r=g.val())?r:{}).sort(((e,t)=>e.created-t.created)).map((e=>e.value));if(!i)return;u("Initializing Audio");const p=await nt.decodeAudioData(c);i&&(u("Starting"),i&&e.replacePage({kind:"animator",...tt(p,a.config,f)}))}().catch((e=>{console.log(e),s(e.toString())})),[d(We,{get popPage(){return e.popPage}}),d(U,{get when(){return l()},get fallback(){return(()=>{const e=Re.cloneNode(!0),t=e.firstChild,n=t.nextSibling;return n.nextSibling,a(e,d(lt,{}),t),a(e,c,n),e})()},children:e=>(()=>{const t=Fe.cloneNode(!0),n=t.firstChild.nextSibling;return n.nextSibling,a(t,c,n),a(t,e,null),t})()})]}function ot(e){return(()=>{const t=Be.cloneNode(!0);return a(t,(()=>e.attribution.text)),i((()=>l(t,"href",e.attribution.url))),t})()}function at(e){const[t,n]=r(window.__audio_initialized),[o,l]=r(!1);return d(O,{get when(){return t()},get fallback(){return(()=>{const t=Oe.cloneNode(!0),r=t.firstChild;return t.$$click=()=>{const t=e.state.audio_ctx.createBufferSource();t.buffer=e.state.audio,t.connect(e.state.audio_ctx.destination),t.start(0,0,.2),l(!0),t.addEventListener("ended",(()=>{window.__audio_initialized=!0,l(!1),n(!0)}))},r.className="border px-4 py-2 shadow-md bg-white transform hover:scale-110 hover:shadow-lg transition sm:min-w-max sm:w-30 ",a(r,d(O,{get when(){return!o()},get fallback(){return d(lt,{})},children:"Start"})),i((()=>t.disabled=o())),t})()},get children(){return e.children}})}function it(e){return(()=>{const t=ge.cloneNode(!0);return a(t,(()=>e.children)),i((()=>t.className="min-h-full flex flex-col flex-wrap items-center bg-gray-100"+(!0===e.horizontal?"":" justify-center"))),t})()}function lt(){return(()=>{const e=Ue.cloneNode(!0),t=e.firstChild.nextSibling.nextSibling;return l(t,"d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"),e})()}function st(){return d(Ze,{})}function ct(e){const[t,n]=C({kind:"loading"});console.log("waiting for",e);const r=L(e,(e=>{console.log("got value",e);const t=e.val();n(E({kind:"loaded",value:t},{merge:!0}))}),(e=>{console.log(e),n(E({kind:"error",message:e.toString()},{merge:!0}))}));return o((()=>r())),[t]}console.log("hmr reload"),p(["input","keydown","click"]),M({apiKey:"AIzaSyAJ3J40bR4cGKRrhQdsGE5W-aRSc6RbFBc",authDomain:"animator-9443f.firebaseapp.com",databaseURL:"https://animator-9443f-default-rtdb.firebaseio.com",storageBucket:"animator-9443f.appspot.com"}),z((()=>d(ce,{data:0,get children(){return d(st,{})}})),document.getElementById("app"));
